var ChromecastJS=function(e,t){if(void 0===window.chrome.cast){var a=document.createElement("script");a.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.body.appendChild(a)}var n=this;n.Scope=e||"tab_and_origin_scoped",n.Receiver=t||"CC1AD845",n.Events=[],n.Available=!1,n.Connected=!1,n.Player=null,n.Controller=null,n.Session=null,n.Template={content:null,poster:null,title:null,description:null,subtitles:[],time:0,duration:0,volume:.3,muted:!1,paused:!1,state:"DISCONNECTED"},n.Media=n.Template,ChromecastJS.prototype.on=function(e,t){return n.Events[e]=t,n},ChromecastJS.prototype.cast=function(e,t){if(!e.content)return void 0!==n.Events.error&&n.Events.error("No media content specified."),void(t&&t("No media content specified."));for(var a in e)e.hasOwnProperty(a)&&(n.Media[a]=e[a]);cast.framework.CastContext.getInstance().requestSession().then(function(){t&&t(null)},function(e){t&&t(e),void 0!==n.Events.error&&n.Events.error("ChromecastJS.cast():",e)})},ChromecastJS.prototype.seek=function(e){return n.Connected&&n.Player.canSeek?(n.Player.currentTime=n.Controller.getSeekTime(e,n.Player.duration),n.Controller.seek(),n):n},ChromecastJS.prototype.volume=function(e){return n.Connected&&n.Player.canPause?(n.Player.volumeLevel=e,n.Controller.setVolumeLevel(),n):n},ChromecastJS.prototype.playOrPause=function(){return n.Connected&&n.Player.canPause?(n.Controller.playOrPause(),n):n},ChromecastJS.prototype.muteOrUnmute=function(){return n.Connected&&n.Player.canControlVolume?(n.Controller.muteOrUnmute(),n):n},ChromecastJS.prototype.changeSubtitle=function(e){if(!n.Connected)return n;var t=new chrome.cast.media.EditTracksInfoRequest([e]);return cast.framework.CastContext.getInstance().b.getSessionObj().media[0].editTracksInfo(t,null,null),n},ChromecastJS.prototype.disconnect=function(){return cast.framework.CastContext.getInstance().endCurrentSession(),n};var r=setInterval(function(){void 0!==window.chrome&&void 0!==window.chrome.cast&&window.chrome.cast.isAvailable&&(clearInterval(r),cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:n.Receiver,autoJoinPolicy:n.Scope}),n.Player=new cast.framework.RemotePlayer,n.Controller=new cast.framework.RemotePlayerController(n.Player),n.Controller.addEventListener("isConnectedChanged",o),n.Controller.addEventListener("currentTimeChanged",i),n.Controller.addEventListener("durationChanged",i),n.Controller.addEventListener("volumeLevelChanged",s),n.Controller.addEventListener("isMutedChanged",l),n.Controller.addEventListener("playerStateChanged",d),n.Available=!0,void 0!==n.Events.available&&n.Events.available())},250);function o(){setTimeout(function(){if(n.Player.isConnected)if(n.Connected=!0,void 0!==n.Events.connected&&n.Events.connected(),n.Player.isMediaLoaded){n.Media={content:n.Player.mediaInfo.contentId,poster:n.Player.imageUrl||null,title:n.Player.title||null,description:n.Player.mediaInfo.metadata.subtitle||null,subtitles:[],time:n.Player.currentTime,duration:n.Player.duration,volume:n.Player.volumeLevel,muted:n.Player.isMuted,state:n.Player.playerState};for(var e=0;e<n.Player.mediaInfo.tracks.length;e++)"TEXT"===n.Player.mediaInfo.tracks[e].type&&n.Media.subtitles.push({label:n.Player.mediaInfo.tracks[e].name,srclang:n.Player.mediaInfo.tracks[e].language,src:n.Player.mediaInfo.tracks[e].trackContentId});void 0!==n.Events.media&&n.Events.media(n.Media)}else if(n.Session=cast.framework.CastContext.getInstance().getCurrentSession(),n.Session&&n.Media.content){var t=new chrome.cast.media.MediaInfo(n.Media.content);if(t.metadata=new chrome.cast.media.GenericMediaMetadata,n.Media.subtitles.length>0){t.textTrackStyle=new chrome.cast.media.TextTrackStyle,t.textTrackStyle.fontFamily="Arial",t.textTrackStyle.foregroundColor="#FFFFFF",t.textTrackStyle.backgroundColor="#00000000",t.textTrackStyle.fontScale="1.1",t.textTrackStyle.edgeColor="#00000099",t.textTrackStyle.edgeType=chrome.cast.media.TextTrackEdgeType.DROP_SHADOW;var a=[];for(e=0;e<n.Media.subtitles.length;e++){var r=new chrome.cast.media.Track(e+1,chrome.cast.media.TrackType.TEXT);r.trackContentId=n.Media.subtitles[e].src,r.trackContentType="text/vtt",r.subtype=chrome.cast.media.TextTrackType.CAPTIONS,r.name=n.Media.subtitles[e].label,r.language=n.Media.subtitles[e].srclang,a.push(r)}t.tracks=a}n.Media.poster&&(t.metadata.images=[{url:n.Media.poster}]),n.Media.title&&(t.metadata.title=n.Media.title),n.Media.description&&(t.metadata.subtitle=n.Media.description);var o=new chrome.cast.media.LoadRequest(t);if(o.currentTime=n.Media.time,o.autoplay=!n.Media.paused,n.Media.subtitles.length>0)for(e=0;e<n.Media.subtitles.length;e++)void 0!==n.Media.subtitles[e].active&&(o.activeTrackIds=[e+1]);n.Session.loadMedia(o).then(function(){void 0!==n.Events.media&&n.Events.media(n.Media)},function(e){void 0!==n.Events.error&&n.Events.error("ChromecastJS.cast():",e)})}},0)}function i(){n.Media.time=n.Player.currentTime,void 0!==n.Events.time&&n.Events.time({progress:n.Controller.getSeekPosition(n.Player.currentTime,n.Player.duration)||0,time:n.Controller.getFormattedTime(n.Player.currentTime),duration:n.Controller.getFormattedTime(n.Player.duration)})}function s(){n.Media.volume=n.Player.volumeLevel,void 0!==n.Events.volume&&n.Events.volume(n.Media.volume)}function l(){n.Media.muted=n.Player.isMuted,void 0!==n.Events.muteOrUnmute&&n.Events.muteOrUnmute(n.Media.muted)}function d(){n.Player.playerState?n.Media.state=n.Player.playerState:(cast.framework.CastContext.getInstance().endCurrentSession(),n.Media=n.Template,n.Media.state="DISCONNECTED",void 0!==n.Events.disconnect&&n.Events.disconnect()),void 0!==n.Events.state&&n.Events.state(n.Media.state)}};
