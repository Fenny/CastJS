var ChromecastJS=function(e,t){var a=this;a.Scope=e||"tab_and_origin_scoped",a.Receiver=t||"CC1AD845",a.Events=[],a.Available=!1,a.Connected=!1,a.Player=null,a.Controller=null,a.Session=null,a.Template={content:null,poster:null,title:null,description:null,subtitles:[],time:0,duration:0,volume:.3,muted:!1,paused:!1,state:"DISCONNECTED"},a.Media=a.Template,ChromecastJS.prototype.on=function(e,t){a.Events[e]=t},ChromecastJS.prototype.cast=function(e,t){if(!e.content)return t&&t("No media content specified."),n("error","No media content specified.");for(var r in e)e.hasOwnProperty(r)&&(a.Media[r]=e[r]);cast.framework.CastContext.getInstance().requestSession().then(function(){t&&t(null)},function(e){t&&t(e),n("error","ChromecastJS.cast(): "+e)})},ChromecastJS.prototype.seek=function(e){if(!a.Connected||!a.Player.canSeek)return n("error",".seek(): Not connected or can't seek");a.Player.currentTime=a.Controller.getSeekTime(e,a.Player.duration),a.Controller.seek()},ChromecastJS.prototype.volume=function(e){if(!a.Connected||!a.Player.canControlVolume)return n("error",".volume(): Not connected or can't control volume");a.Player.volumeLevel=e/100,a.Controller.setVolumeLevel()},ChromecastJS.prototype.playOrPause=function(){if(!a.Connected||!a.Player.canPause)return n("error",".playOrPause(): Not connected or can't pause or play");a.Controller.playOrPause()},ChromecastJS.prototype.muteOrUnmute=function(){if(!a.Connected||!a.Player.canControlVolume)return n("error",".muteOrUnmute(): Not connected or can't control volume");a.Controller.muteOrUnmute()},ChromecastJS.prototype.changeSubtitle=function(e){if(!a.Connected)return n("error",".changeSubtitle(): Not connected");var t=new chrome.cast.media.EditTracksInfoRequest([e]);cast.framework.CastContext.getInstance().b.getSessionObj().media[0].editTracksInfo(t,null,null);for(var r=0;r<a.Media.subtitles.length;r+=1)a.Media.subtitles[r].active=!1,r===e&&(a.Media.subtitles[r].active=!0)},ChromecastJS.prototype.disconnect=function(){cast.framework.CastContext.getInstance().endCurrentSession()};var r=setInterval(function(){void 0!==window.chrome&&void 0!==window.chrome.cast&&window.chrome.cast.isAvailable&&(clearInterval(r),cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:a.Receiver,autoJoinPolicy:a.Scope}),a.Player=new cast.framework.RemotePlayer,a.Controller=new cast.framework.RemotePlayerController(a.Player),a.Controller.addEventListener("isConnectedChanged",o),a.Controller.addEventListener("currentTimeChanged",function(){a.Media.time=a.Player.currentTime,n("time",{progress:a.Controller.getSeekPosition(a.Player.currentTime,a.Player.duration)||0,time:a.Controller.getFormattedTime(a.Player.currentTime),duration:a.Controller.getFormattedTime(a.Player.duration)})}),a.Controller.addEventListener("durationChanged",function(){a.Media.duration=a.Player.duration}),a.Controller.addEventListener("volumeLevelChanged",function(){a.Media.volume=100*a.Player.volumeLevel,n("volume",a.Media.volume)}),a.Controller.addEventListener("isMutedChanged",function(){console.log(a.Player.isMuted),a.Media.muted=a.Player.isMuted,n("muteOrUnmute",a.Media.muted)}),a.Controller.addEventListener("isPausedChanged",function(){a.Media.paused=a.Player.isPaused,n("playOrPause",a.Media.paused)}),a.Controller.addEventListener("playerStateChanged",function(){a.Player.playerState?a.Media.state=a.Player.playerState:(cast.framework.CastContext.getInstance().endCurrentSession(),a.Controller.stop(),a.Media=a.Template,a.Player.isMediaLoaded=!1,a.Media.state="DISCONNECTED",n("disconnect")),n("state",a.Media.state)}),a.Available=!0,n("available"))},250);function n(e,t){if(void 0!==a.Events[e]){if(void 0!==t)return a.Events[e](t);a.Events[e]()}}function o(){setTimeout(function(){if(a.Player.isConnected){if(a.Connected=!0,n("connected"),a.Player.isMediaLoaded&&a.Player.playerState){a.Media={content:a.Player.mediaInfo.contentId,poster:a.Player.imageUrl||null,title:a.Player.title||null,description:a.Player.mediaInfo.metadata.subtitle||null,subtitles:[],time:a.Player.currentTime,duration:a.Player.duration,volume:a.Player.volumeLevel,muted:a.Player.isMuted,state:a.Player.playerState};for(var e=0;e<a.Player.mediaInfo.tracks.length;e+=1)"TEXT"===a.Player.mediaInfo.tracks[e].type&&a.Media.subtitles.push({active:!1,label:a.Player.mediaInfo.tracks[e].name,srclang:a.Player.mediaInfo.tracks[e].language,src:a.Player.mediaInfo.tracks[e].trackContentId});var t=cast.framework.CastContext.getInstance().b.getSessionObj().media[0].activeTrackIds[0];t&&void 0!==a.Media.subtitles[t]&&(a.Media.subtitles[t].active=!0),n("media",a.Media)}else if(a.Session=cast.framework.CastContext.getInstance().getCurrentSession(),a.Session&&a.Media.content){var r=new chrome.cast.media.MediaInfo(a.Media.content);if(r.metadata=new chrome.cast.media.GenericMediaMetadata,a.Media.subtitles.length>0){r.textTrackStyle=new chrome.cast.media.TextTrackStyle,r.textTrackStyle.fontFamily="Arial",r.textTrackStyle.foregroundColor="#FFFFFF",r.textTrackStyle.backgroundColor="#00000000",r.textTrackStyle.fontScale="1.1",r.textTrackStyle.edgeColor="#00000099",r.textTrackStyle.edgeType=chrome.cast.media.TextTrackEdgeType.DROP_SHADOW;var o=[];for(e=0;e<a.Media.subtitles.length;e+=1){var i=new chrome.cast.media.Track(e,chrome.cast.media.TrackType.TEXT);i.trackContentId=a.Media.subtitles[e].src,i.trackContentType="text/vtt",i.subtype=chrome.cast.media.TextTrackType.CAPTIONS,i.name=a.Media.subtitles[e].label,i.language=a.Media.subtitles[e].srclang,o.push(i)}r.tracks=o}a.Media.poster&&(r.metadata.images=[{url:a.Media.poster}]),a.Media.title&&(r.metadata.title=a.Media.title),a.Media.description&&(r.metadata.subtitle=a.Media.description);var l=new chrome.cast.media.LoadRequest(r);if(l.currentTime=a.Media.time,l.autoplay=!a.Media.paused,a.Media.subtitles.length>0)for(e=0;e<a.Media.subtitles.length;e+=1)void 0!==a.Media.subtitles[e].active&&a.Media.subtitles[e].active&&(l.activeTrackIds=[e]);a.Session.loadMedia(l).then(function(){n("media",a.Media)},function(e){n("error","ChromecastJS.cast():")})}}else a.Connected=!1},0)}};
