var ChromecastJS=function(e,t){var a=this;a.JoinPolicy=e||"origin_scoped",a.Receiver=t||"CC1AD845",a.Events=[],a.Available=!1,a.Connected=!1,a.Player=null,a.Controller=null,a.Session=null,a.Template={content:null,poster:null,title:null,description:null,subtitles:[],progress:0,time:0,duration:0,volume:.3,muted:!1,paused:!1,state:"DISCONNECTED"},a.Media=Object.assign({},a.Template);var r=setInterval(function(){window.chrome&&window.chrome.cast&&window.chrome.cast.isAvailable&&(clearInterval(r),cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:a.Receiver,autoJoinPolicy:a.JoinPolicy}),a.Player=new cast.framework.RemotePlayer,a.Controller=new cast.framework.RemotePlayerController(a.Player),a.Controller.addEventListener("isConnectedChanged",n),a.Controller.addEventListener("currentTimeChanged",i),a.Controller.addEventListener("durationChanged",s),a.Controller.addEventListener("volumeLevelChanged",l),a.Controller.addEventListener("isMutedChanged",d),a.Controller.addEventListener("isPausedChanged",c),a.Controller.addEventListener("playerStateChanged",u),a.Available=!0,o("available"))},250);function o(e,t){a.Events[e]&&a.Events[e](t)}function n(){setTimeout(function(){if(a.Player.isConnected){if(a.Connected=!0,o("connected"),a.Player.isMediaLoaded&&a.Player.playerState){a.Media={content:a.Player.mediaInfo.contentId,poster:a.Player.imageUrl||null,title:a.Player.title||null,description:a.Player.mediaInfo.metadata.subtitle||null,subtitles:[],progress:a.Controller.getSeekPosition(a.Player.currentTime,a.Player.duration),time:a.Controller.getFormattedTime(a.Player.currentTime),duration:a.Controller.getFormattedTime(a.Player.duration),volume:a.Player.volumeLevel,muted:a.Player.isMuted,state:a.Player.playerState};for(var e=0;e<a.Player.mediaInfo.tracks.length;e++)"TEXT"===a.Player.mediaInfo.tracks[e].type&&a.Media.subtitles.push({label:a.Player.mediaInfo.tracks[e].name,src:a.Player.mediaInfo.tracks[e].trackContentId});var t=cast.framework.CastContext.getInstance().getCurrentSession().getSessionObj().media[0].activeTrackIds[0];void 0!==t&&a.Media.subtitles[t]&&(a.Media.subtitles[t].active=!0),o("media",a.Media)}else if(a.Session=cast.framework.CastContext.getInstance().getCurrentSession(),a.Session&&a.Media.content){var r=new chrome.cast.media.MediaInfo(a.Media.content);if(r.metadata=new chrome.cast.media.GenericMediaMetadata,a.Media.subtitles.length){r.textTrackStyle=new chrome.cast.media.TextTrackStyle,r.textTrackStyle.fontFamily="Arial",r.textTrackStyle.foregroundColor="#FFFFFF",r.textTrackStyle.backgroundColor="#00000000",r.textTrackStyle.fontScale="1.1",r.textTrackStyle.edgeColor="#00000099",r.textTrackStyle.edgeType=chrome.cast.media.TextTrackEdgeType.DROP_SHADOW;var n=[];for(e=0;e<a.Media.subtitles.length;e++){var i=new chrome.cast.media.Track(e,chrome.cast.media.TrackType.TEXT);i.trackContentId=a.Media.subtitles[e].src,i.trackContentType="text/vtt",i.subtype=chrome.cast.media.TextTrackType.CAPTIONS,i.name=a.Media.subtitles[e].label,n.push(i)}r.tracks=n}a.Media.poster&&(r.metadata.images=[{url:a.Media.poster}]),a.Media.title&&(r.metadata.title=a.Media.title),a.Media.description&&(r.metadata.subtitle=a.Media.description);var s=new chrome.cast.media.LoadRequest(r);if(s.currentTime=a.Media.time,s.autoplay=!a.Media.paused,a.Media.subtitles.length>0)for(e=0;e<a.Media.subtitles.length;e++)a.Media.subtitles[e]&&a.Media.subtitles[e].active&&(s.activeTrackIds=[e]);a.Session.loadMedia(s).then(function(){o("media",a.Media)},function(e){o("error","ChromecastJS.cast():")})}}else a.Connected=!1},0)}function i(){a.Media.progress=a.Controller.getSeekPosition(a.Player.currentTime,a.Player.duration),a.Media.time=a.Controller.getFormattedTime(a.Player.currentTime),a.Media.duration=a.Controller.getFormattedTime(a.Player.duration),o("timeupdate",{progress:a.Media.progress,time:a.Media.time,duration:a.Media.duration}),a.Media.progress>=100&&(o("ended"),a.disconnect())}function s(){a.Media.duration=a.Player.duration}function l(){a.Media.volume=Math.round(100*a.Player.volumeLevel),o("volumechange",a.Media.volume)}function d(){a.Media.muted=a.Player.isMuted,o("muteOrUnmute",a.Media.muted)}function c(){a.Media.paused=a.Player.isPaused,o("playOrPause",a.Media.paused)}function u(){if(!a.Player.playerState)return a.disconnect();a.Media.state="IDLE"===a.Player.playerState?"DISCONNECTED":a.Player.playerState,o("state",a.Media.state)}ChromecastJS.prototype.on=function(e,t){a.Events[e]=t},ChromecastJS.prototype.cast=function(e){if(!e||!e.content)return o("error","No media content specified.");for(var t in e)e.hasOwnProperty(t)&&(a.Media[t]=e[t]);cast.framework.CastContext.getInstance().requestSession()},ChromecastJS.prototype.state=function(){return a.Media.state},ChromecastJS.prototype.media=function(){return a.Media},ChromecastJS.prototype.duration=function(e){return{progress:a.Media.progress,time:a.Media.time,duration:a.Media.duration}},ChromecastJS.prototype.seek=function(e){a.Player.currentTime=a.Controller.getSeekTime(e,a.Player.duration),a.Controller.seek()},ChromecastJS.prototype.volume=function(e){if(void 0===e)return Math.round(100*a.Player.volumeLevel);a.Player.volumeLevel=e/100,a.Controller.setVolumeLevel()},ChromecastJS.prototype.play=function(){a.Player.isPaused&&a.Controller.playOrPause()},ChromecastJS.prototype.pause=function(){a.Player.isPaused||a.Controller.playOrPause()},ChromecastJS.prototype.paused=function(){return a.Player.isPaused},ChromecastJS.prototype.muted=function(e){if(void 0===e)return cc.Player.isMuted;e&&!a.Player.isMuted?a.Controller.muteOrUnmute():!e&&a.Player.isMuted&&a.Controller.muteOrUnmute()},ChromecastJS.prototype.subtitles=function(e){if(void 0===e)return a.Media.subtitles;var t=new chrome.cast.media.EditTracksInfoRequest([e]);cast.framework.CastContext.getInstance().getCurrentSession().getSessionObj().media[0].editTracksInfo(t,null,null);for(var r=0;r<a.Media.subtitles.length;r++)delete a.Media.subtitles[r].active,r===e&&(a.Media.subtitles[r].active=!0)},ChromecastJS.prototype.disconnect=function(){cast.framework.CastContext.getInstance().endCurrentSession(!0),a.Controller.stop(),a.Media=Object.assign({},a.Template),a.Player.isMediaLoaded=!1,a.Media.state="DISCONNECTED",o("disconnected")}};
