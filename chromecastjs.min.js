var ChromecastJS=function(e,t){if("undefined"==typeof cast){var a=document.createElement("script");a.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.body.appendChild(a)}var n=this;this.Available=!1,this.Events=[],this.Player=null,this.Controller=null,this.Session=null,this.MediaTemplate={content:null,poster:null,title:null,description:null,subtitles:[],time:0,duration:0,volume:.5,muted:!1,paused:!1,state:"DISCONNECTED"},this.Media=this.MediaTemplate,ChromecastJS.prototype.on=function(e,t){this.Events[e]=t},ChromecastJS.prototype.cast=function(e,t){if(e.content){cast.framework.CastContext.getInstance().requestSession().then(function(){t&&t(null)},function(e){t&&t(e),void 0!==n.Events.error&&n.Events.error("requestSession:",e)});for(var a in e)e.hasOwnProperty(a)&&(n.Media[a]=e[a])}else void 0!==n.Events.error&&n.Events.error("No media content specified.")},ChromecastJS.prototype.seek=function(e){e&&n.Player.canSeek&&(n.Player.currentTime=n.Controller.getSeekTime(e,n.Player.duration),n.Controller.seek())},ChromecastJS.prototype.volume=function(e){n.Player.volumeLevel=e,n.Controller.setVolumeLevel()},ChromecastJS.prototype.playOrPause=function(){n.Controller.playOrPause()},ChromecastJS.prototype.muteOrUnmute=function(){n.Controller.muteOrUnmute()},ChromecastJS.prototype.disconnect=function(){cast.framework.CastContext.getInstance().endCurrentSession()},ChromecastJS.prototype.changeSubtitle=function(e){var t=new chrome.cast.media.EditTracksInfoRequest([e+1]);cast.framework.CastContext.getInstance().b.getSessionObj().media[0].editTracksInfo(t,null,null)};var r=setInterval(function(){void 0!==window.chrome&&void 0!==window.chrome.cast&&window.chrome.cast.isAvailable&&(clearInterval(r),cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:t||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:e||chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED}),n.Player=new cast.framework.RemotePlayer,n.Controller=new cast.framework.RemotePlayerController(n.Player),n.Controller.addEventListener("isConnectedChanged",o),n.Controller.addEventListener("currentTimeChanged",i),n.Controller.addEventListener("durationChanged",s),n.Controller.addEventListener("volumeLevelChanged",l),n.Controller.addEventListener("isMutedChanged",d),n.Controller.addEventListener("playerStateChanged",c),n.Available=!0,void 0!==n.Events.available&&n.Events.available())},250);function o(){setTimeout(function(){if(n.Player.isConnected)if(void 0!==n.Events.connected&&n.Events.connected(),n.Player.isMediaLoaded){n.Media={content:n.Player.mediaInfo.contentId,poster:n.Player.imageUrl||null,title:n.Player.title||null,description:n.Player.mediaInfo.metadata.subtitle||null,subtitles:[],time:n.Player.currentTime,duration:n.Player.duration,volume:n.Player.volumeLevel,muted:n.Player.isMuted,state:n.Player.playerState};for(var e=0;e<n.Player.mediaInfo.tracks.length;e++)"TEXT"==n.Player.mediaInfo.tracks[e].type&&n.Media.subtitles.push({label:n.Player.mediaInfo.tracks[e].name,srclang:n.Player.mediaInfo.tracks[e].language,src:n.Player.mediaInfo.tracks[e].trackContentId});void 0!==n.Events.media&&n.Events.media(n.Media)}else if(n.Session=cast.framework.CastContext.getInstance().getCurrentSession(),n.Session){var t=new chrome.cast.media.MediaInfo(n.Media.content);t.metadata=new chrome.cast.media.GenericMediaMetadata,n.Media.subtitles.length>0&&(t.textTrackStyle=((r=new chrome.cast.media.TextTrackStyle).fontFamily="Arial",r.foregroundColor="#FFFFFF",r.backgroundColor="#00000000",r.fontScale="1.1",r.edgeColor="#00000099",r.edgeType=chrome.cast.media.TextTrackEdgeType.DROP_SHADOW,r),t.tracks=function(e){for(var t=[],a=0;a<e.length;a++){var n=new chrome.cast.media.Track(a+1,chrome.cast.media.TrackType.TEXT);n.trackContentId=e[a].src,n.trackContentType="text/vtt",n.subtype=chrome.cast.media.TextTrackType.CAPTIONS,n.name=e[a].label,n.language=e[a].srclang,t.push(n)}return t}(n.Media.subtitles)),n.Media.poster&&(t.metadata.images=[{url:n.Media.poster}]),n.Media.title&&(t.metadata.title=n.Media.title),n.Media.description&&(t.metadata.subtitle=n.Media.description);var a=new chrome.cast.media.LoadRequest(t);if(a.currentTime=n.Media.time,a.autoplay=!n.Media.paused,n.Media.subtitles.length>0)for(e=0;e<n.Media.subtitles.length;e++)void 0!==n.Media.subtitles[e].active&&(a.activeTrackIds=[e+1]);n.Session.loadMedia(a).then(function(){void 0!==n.Events.media&&n.Events.media(n.Media)},function(e){void 0!==n.Events.error&&n.Events.error("loadMedia:",e)})}var r},0)}function i(){n.Media.time=n.Player.currentTime,void 0!==n.Events.time&&n.Events.time({progress:n.Controller.getSeekPosition(n.Player.currentTime,n.Player.duration)||0,time:n.Controller.getFormattedTime(n.Player.currentTime),duration:n.Controller.getFormattedTime(n.Player.duration)})}function s(){n.Media.duration=n.Player.duration,void 0!==n.Events.time&&n.Events.time({progress:n.Controller.getSeekPosition(n.Player.currentTime,n.Player.duration)||0,time:n.Controller.getFormattedTime(n.Player.currentTime),duration:n.Controller.getFormattedTime(n.Player.duration)})}function l(){n.Media.volume=n.Player.volumeLevel,void 0!==n.Events.volume&&n.Events.volume(n.Media.volume)}function d(){n.Media.muted=n.Player.isMuted,void 0!==n.Events.muteOrUnmute&&n.Events.muteOrUnmute(n.Media.muted)}function c(){n.Player.playerState?n.Media.state=n.Player.playerState:(n.Media=n.MediaTemplate,cast.framework.CastContext.getInstance().endCurrentSession(),n.Media=n.MediaTemplate,n.Media.state="DISCONNECTED",void 0!==n.Events.disconnect&&n.Events.disconnect()),void 0!==n.Events.state&&n.Events.state(n.Media.state)}};
