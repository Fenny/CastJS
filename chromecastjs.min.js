var castSender=document.createElement("script");castSender.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.body.appendChild(castSender);var ChromeCastJS=function(e,t){var n=this;this.Available=!1,this.Events=[],this.Player=null,this.Controller=null,this.Session=null,this.MediaTemplate={content:null,poster:null,title:null,description:null,subtitles:[],time:0,duration:0,volume:.5,muted:!1,paused:!1,state:"DISCONNECTED"},this.Media=this.MediaTemplate,ChromeCastJS.prototype.on=function(e,t){this.Events[e]=t},ChromeCastJS.prototype.cast=function(e,t){if(e.content){cast.framework.CastContext.getInstance().requestSession().then(function(){t&&t(null)},function(e){t&&t(e),void 0!==n.Events.error&&n.Events.error("requestSession:",e)});for(var a in e)e.hasOwnProperty(a)&&(n.Media[a]=e[a])}else void 0!==n.Events.error&&n.Events.error("No media content specified.")},ChromeCastJS.prototype.seek=function(e){e&&n.Player.canSeek&&(n.Player.currentTime=n.Controller.getSeekTime(e,n.Player.duration),n.Controller.seek())},ChromeCastJS.prototype.volume=function(e){n.Player.volumeLevel=e,n.Controller.setVolumeLevel()},ChromeCastJS.prototype.playOrPause=function(){n.Controller.playOrPause()},ChromeCastJS.prototype.muteOrUnmute=function(){n.Controller.muteOrUnmute()},ChromeCastJS.prototype.disconnect=function(){cast.framework.CastContext.getInstance().endCurrentSession()},ChromeCastJS.prototype.changeSubtitle=function(e){var t=new chrome.cast.media.EditTracksInfoRequest([e+1]);cast.framework.CastContext.getInstance().b.getSessionObj().media[0].editTracksInfo(t,null,null)};var a=setInterval(function(){void 0!==window.chrome&&void 0!==window.chrome.cast&&window.chrome.cast.isAvailable&&(clearInterval(a),cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:e||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:t||chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED}),n.Player=new cast.framework.RemotePlayer,n.Controller=new cast.framework.RemotePlayerController(n.Player),n.Controller.addEventListener("isConnectedChanged",o),n.Controller.addEventListener("currentTimeChanged",r),n.Controller.addEventListener("durationChanged",i),n.Controller.addEventListener("volumeLevelChanged",s),n.Controller.addEventListener("isMutedChanged",l),n.Controller.addEventListener("playerStateChanged",c),n.Available=!0,n.Events.available(!0))},250);function o(){setTimeout(function(){if(n.Player.isConnected)if(void 0!==n.Events.connected&&n.Events.connected(),n.Player.isMediaLoaded){n.Media={content:n.Player.mediaInfo.contentId,poster:n.Player.imageUrl||null,title:n.Player.title||null,description:n.Player.mediaInfo.metadata.subtitle||null,subtitles:[],time:n.Player.currentTime,duration:n.Player.duration,volume:n.Player.volumeLevel,muted:n.Player.isMuted,state:n.Player.playerState};for(var e=0;e<n.Player.mediaInfo.tracks.length;e++)"TEXT"==n.Player.mediaInfo.tracks[e].type&&n.Media.subtitles.push({label:n.Player.mediaInfo.tracks[e].name,srclang:n.Player.mediaInfo.tracks[e].language,src:n.Player.mediaInfo.tracks[e].trackContentId});n.Player.mediaInfo.tracks.length&&n.Player.mediaInfo.tracks,void 0!==n.Events.media&&n.Events.media(n.Media)}else if(n.Session=cast.framework.CastContext.getInstance().getCurrentSession(),n.Session){var t=new chrome.cast.media.MediaInfo(n.Media.content,"video/mp4");t.metadata=new chrome.cast.media.GenericMediaMetadata,n.Media.subtitles.length>0&&(t.textTrackStyle=((o=new chrome.cast.media.TextTrackStyle).fontFamily="Arial",o.foregroundColor="#FFFFFF",o.backgroundColor="#00000000",o.fontScale="1.1",o.edgeColor="#00000099",o.edgeType=chrome.cast.media.TextTrackEdgeType.DROP_SHADOW,o),t.tracks=function(e){for(var t=[],n=0;n<e.length;n++){var a=new chrome.cast.media.Track(n+1,chrome.cast.media.TrackType.TEXT);a.trackContentId=e[n].src,a.trackContentType="text/vtt",a.subtype=chrome.cast.media.TextTrackType.CAPTIONS,a.name=e[n].label,a.language=e[n].srclang,t.push(a)}return t}(n.Media.subtitles)),n.Media.poster&&(t.metadata.images=[{url:n.Media.poster}]),n.Media.title&&(t.metadata.title=n.Media.title),n.Media.description&&(t.metadata.subtitle=n.Media.description);var a=new chrome.cast.media.LoadRequest(t);if(a.currentTime=n.Media.time,a.autoplay=!n.Media.paused,n.Media.subtitles.length>0)for(e=0;e<n.Media.subtitles.length;e++)void 0!==n.Media.subtitles[e].active&&(a.activeTrackIds=[e+1]);n.Session.loadMedia(a).then(function(){void 0!==n.Events.media&&n.Events.media(n.Media)},function(e){void 0!==n.Events.error&&n.Events.error("loadMedia:",e)})}var o},0)}function r(){n.Media.time=n.Player.currentTime,void 0!==n.Events.time&&n.Events.time({progress:n.Controller.getSeekPosition(n.Player.currentTime,n.Player.duration)||0,time:n.Controller.getFormattedTime(n.Player.currentTime),duration:n.Controller.getFormattedTime(n.Player.duration)})}function i(){n.Media.duration=n.Player.duration,void 0!==n.Events.time&&n.Events.time({progress:n.Controller.getSeekPosition(n.Player.currentTime,n.Player.duration)||0,time:n.Controller.getFormattedTime(n.Player.currentTime),duration:n.Controller.getFormattedTime(n.Player.duration)})}function s(){n.Media.volume=n.Player.volumeLevel,void 0!==n.Events.volume&&n.Events.volume(n.Media.volume)}function l(){n.Media.muted=n.Player.isMuted,void 0!==n.Events.muteOrUnmute&&n.Events.muteOrUnmute(n.Media.muted)}function c(){n.Player.playerState?n.Media.state=n.Player.playerState:(n.Media=n.MediaTemplate,cast.framework.CastContext.getInstance().endCurrentSession(),n.Media=n.MediaTemplate,n.Media.state="DISCONNECTED",void 0!==n.Events.disconnect&&n.Events.disconnect()),void 0!==n.Events.state&&n.Events.state(n.Media.state)}},cc=new ChromeCastJS;cc.on("available",function(){console.log("chromecast is available")}),cc.on("connected",function(){console.log("chromecast is connected")}),cc.on("media",function(e){console.log("media changed:",e)}),cc.on("playOrPause",function(e){console.log("playorpause:",e)}),cc.on("muteOrUnmute",function(e){console.log("muteOrUnmute:",e)}),cc.on("volume",function(e){console.log("volume:",e)}),cc.on("state",function(e){console.log("state:",e)}),cc.on("time",function(e){console.log("time:",e)}),cc.on("disconnect",function(){console.log("disconnected")}),cc.on("error",function(e){console.log("error:",e)});var media={content:"http://192.168.1.187:8080/api/stream/580393497",poster:"https://cdn.movies.lc/t/p/w185//bT5WuAsjDJYQv2vXbWGDQTmjKav.jpg",title:"BlacKkKlansman",description:"2018",time:1617,subtitles:[{active:!0,label:"English",srclang:"gb",src:"http://192.168.1.187:8080/subs/7349662/0_135897_English_gb.vtt"},{label:"English",srclang:"gb",src:"http://192.168.1.187:8080/subs/7349662/0_135898_English_gb.vtt"},{label:"France",srclang:"fr",src:"http://192.168.1.187:8080/subs/7349662/0_135960_French_fr.vtt"}]};document.getElementById("CastMedia").addEventListener("click",function(){cc.cast(media)});
