var castSender=document.createElement("script");castSender.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.body.appendChild(castSender);var ChromecastJS=function(e,t){var a=this;this.Available=!1,this.Events=[],this.Player=null,this.Controller=null,this.Session=null,this.MediaTemplate={content:null,poster:null,title:null,description:null,subtitles:[],time:0,duration:0,volume:.5,muted:!1,paused:!1,state:"DISCONNECTED"},this.Media=this.MediaTemplate,ChromecastJS.prototype.on=function(e,t){this.Events[e]=t},ChromecastJS.prototype.cast=function(e,t){if(e.content){cast.framework.CastContext.getInstance().requestSession().then(function(){t&&t(null)},function(e){t&&t(e),void 0!==a.Events.error&&a.Events.error("requestSession:",e)});for(var r in e)e.hasOwnProperty(r)&&(a.Media[r]=e[r])}else void 0!==a.Events.error&&a.Events.error("No media content specified.")},ChromecastJS.prototype.seek=function(e){e&&a.Player.canSeek&&(a.Player.currentTime=a.Controller.getSeekTime(e,a.Player.duration),a.Controller.seek())},ChromecastJS.prototype.volume=function(e){a.Player.volumeLevel=e,a.Controller.setVolumeLevel()},ChromecastJS.prototype.playOrPause=function(){a.Controller.playOrPause()},ChromecastJS.prototype.muteOrUnmute=function(){a.Controller.muteOrUnmute()},ChromecastJS.prototype.disconnect=function(){cast.framework.CastContext.getInstance().endCurrentSession()},ChromecastJS.prototype.changeSubtitle=function(e){var t=new chrome.cast.media.EditTracksInfoRequest([e+1]);cast.framework.CastContext.getInstance().b.getSessionObj().media[0].editTracksInfo(t,null,null)};var r=setInterval(function(){void 0!==window.chrome&&void 0!==window.chrome.cast&&window.chrome.cast.isAvailable&&(clearInterval(r),cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:t||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:e||chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED}),a.Player=new cast.framework.RemotePlayer,a.Controller=new cast.framework.RemotePlayerController(a.Player),a.Controller.addEventListener("isConnectedChanged",n),a.Controller.addEventListener("currentTimeChanged",o),a.Controller.addEventListener("durationChanged",i),a.Controller.addEventListener("volumeLevelChanged",s),a.Controller.addEventListener("isMutedChanged",l),a.Controller.addEventListener("playerStateChanged",d),a.Available=!0,a.Events.available(!0))},250);function n(){setTimeout(function(){if(a.Player.isConnected)if(void 0!==a.Events.connected&&a.Events.connected(),a.Player.isMediaLoaded){a.Media={content:a.Player.mediaInfo.contentId,poster:a.Player.imageUrl||null,title:a.Player.title||null,description:a.Player.mediaInfo.metadata.subtitle||null,subtitles:[],time:a.Player.currentTime,duration:a.Player.duration,volume:a.Player.volumeLevel,muted:a.Player.isMuted,state:a.Player.playerState};for(var e=0;e<a.Player.mediaInfo.tracks.length;e++)"TEXT"==a.Player.mediaInfo.tracks[e].type&&a.Media.subtitles.push({label:a.Player.mediaInfo.tracks[e].name,srclang:a.Player.mediaInfo.tracks[e].language,src:a.Player.mediaInfo.tracks[e].trackContentId});a.Player.mediaInfo.tracks.length&&a.Player.mediaInfo.tracks,void 0!==a.Events.media&&a.Events.media(a.Media)}else if(a.Session=cast.framework.CastContext.getInstance().getCurrentSession(),a.Session){var t=new chrome.cast.media.MediaInfo(a.Media.content,"video/mp4");t.metadata=new chrome.cast.media.GenericMediaMetadata,a.Media.subtitles.length>0&&(t.textTrackStyle=((n=new chrome.cast.media.TextTrackStyle).fontFamily="Arial",n.foregroundColor="#FFFFFF",n.backgroundColor="#00000000",n.fontScale="1.1",n.edgeColor="#00000099",n.edgeType=chrome.cast.media.TextTrackEdgeType.DROP_SHADOW,n),t.tracks=function(e){for(var t=[],a=0;a<e.length;a++){var r=new chrome.cast.media.Track(a+1,chrome.cast.media.TrackType.TEXT);r.trackContentId=e[a].src,r.trackContentType="text/vtt",r.subtype=chrome.cast.media.TextTrackType.CAPTIONS,r.name=e[a].label,r.language=e[a].srclang,t.push(r)}return t}(a.Media.subtitles)),a.Media.poster&&(t.metadata.images=[{url:a.Media.poster}]),a.Media.title&&(t.metadata.title=a.Media.title),a.Media.description&&(t.metadata.subtitle=a.Media.description);var r=new chrome.cast.media.LoadRequest(t);if(r.currentTime=a.Media.time,r.autoplay=!a.Media.paused,a.Media.subtitles.length>0)for(e=0;e<a.Media.subtitles.length;e++)void 0!==a.Media.subtitles[e].active&&(r.activeTrackIds=[e+1]);a.Session.loadMedia(r).then(function(){void 0!==a.Events.media&&a.Events.media(a.Media)},function(e){void 0!==a.Events.error&&a.Events.error("loadMedia:",e)})}var n},0)}function o(){a.Media.time=a.Player.currentTime,void 0!==a.Events.time&&a.Events.time({progress:a.Controller.getSeekPosition(a.Player.currentTime,a.Player.duration)||0,time:a.Controller.getFormattedTime(a.Player.currentTime),duration:a.Controller.getFormattedTime(a.Player.duration)})}function i(){a.Media.duration=a.Player.duration,void 0!==a.Events.time&&a.Events.time({progress:a.Controller.getSeekPosition(a.Player.currentTime,a.Player.duration)||0,time:a.Controller.getFormattedTime(a.Player.currentTime),duration:a.Controller.getFormattedTime(a.Player.duration)})}function s(){a.Media.volume=a.Player.volumeLevel,void 0!==a.Events.volume&&a.Events.volume(a.Media.volume)}function l(){a.Media.muted=a.Player.isMuted,void 0!==a.Events.muteOrUnmute&&a.Events.muteOrUnmute(a.Media.muted)}function d(){a.Player.playerState?a.Media.state=a.Player.playerState:(a.Media=a.MediaTemplate,cast.framework.CastContext.getInstance().endCurrentSession(),a.Media=a.MediaTemplate,a.Media.state="DISCONNECTED",void 0!==a.Events.disconnect&&a.Events.disconnect()),void 0!==a.Events.state&&a.Events.state(a.Media.state)}};
