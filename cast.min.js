"use strict";function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var Castjs=function(){function n(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,n),!window.chrome)return console.warn("Castjs: Casting is not supported in this browser");"object"===_typeof(e)&&(i=e,e=null),this.receiver=e||"CC1AD845",this.joinpolicy=i.joinpolicy||"origin_scoped",this.language=i.language||null,this.resume=i.resume||!0,this.available=!1,this.session=null,this.device=null,this.player=null,this.controller=null,this.events={},this.template={source:null,poster:null,title:null,description:null,subtitles:[],volume:1,muted:!1,paused:!1,progress:0,time:"00:00:00",duration:"00:00:00",state:"disconnected"},this.media=Object.assign({},this.template);var r=setInterval(function(){window.chrome.cast&&window.chrome.cast.isAvailable&&(clearInterval(r),cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:t.receiver,autoJoinPolicy:t.joinpolicy,language:t.language,resumeSavedSession:t.resume}),t.player=new cast.framework.RemotePlayer,t.controller=new cast.framework.RemotePlayerController(t.player),t.controller.addEventListener("isConnectedChanged",t.controller_isConnectedChanged.bind(t)),t.controller.addEventListener("currentTimeChanged",t.controller_currentTimeChanged.bind(t)),t.controller.addEventListener("durationChanged",t.controller_durationChanged.bind(t)),t.controller.addEventListener("volumeLevelChanged",t.controller_volumeLevelChanged.bind(t)),t.controller.addEventListener("isMutedChanged",t.controller_isMutedChanged.bind(t)),t.controller.addEventListener("isPausedChanged",t.controller_isPausedChanged.bind(t)),t.controller.addEventListener("playerStateChanged",t.controller_playerStateChanged.bind(t)),t.available=!0,t.trigger("available"),t.trigger("any","available"))},250)}function e(e){return t.apply(this,arguments)}var t;return _createClass(n,[{key:"controller_isConnectedChanged",value:function(){var i=this;setTimeout(function(){if(i.session=i.player.isConnected,i.session&&i.player.isMediaLoaded){for(var e in i.device=cast.framework.CastContext.getInstance().getCurrentSession().getCastDevice().friendlyName,i.media={source:i.player.mediaInfo.contentId,poster:i.player.imageUrl||null,title:i.player.title||null,description:i.player.mediaInfo.metadata.subtitle||null,subtitles:[],progress:i.controller.getSeekPosition(i.player.currentTime,i.player.duration),time:i.controller.getFormattedTime(i.player.currentTime),duration:i.controller.getFormattedTime(i.player.duration),volume:i.player.volumeLevel,muted:i.player.isMuted,paused:i.player.isPaused,state:i.player.playerState.toLowerCase()},i.player.mediaInfo.tracks)"TEXT"===i.player.mediaInfo.tracks[e].type&&i.media.subtitles.push({label:i.player.mediaInfo.tracks[e].name,src:i.player.mediaInfo.tracks[e].trackContentId});var t=cast.framework.CastContext.getInstance().getCurrentSession().getSessionObj().media[0].activeTrackIds;t.length&&i.media.subtitles[t[0]]&&(i.media.subtitles[t[0]].active=!0),i.trigger("session"),i.trigger("any","session")}})}},{key:"controller_currentTimeChanged",value:function(){this.media.progress=this.controller.getSeekPosition(this.player.currentTime,this.player.duration),this.media.time=this.controller.getFormattedTime(this.player.currentTime),this.media.duration=this.controller.getFormattedTime(this.player.duration),this.trigger("time",{progress:this.media.progress,time:this.media.time,duration:this.media.duration}),this.trigger("any","time"),100<=this.media.progress&&(this.trigger("end"),this.disconnect())}},{key:"controller_durationChanged",value:function(){this.media.duration=this.player.duration}},{key:"controller_volumeLevelChanged",value:function(){this.media.volume=this.player.volumeLevel,this.trigger("volume",this.media.volume),this.trigger("any","volume")}},{key:"controller_isMutedChanged",value:function(){this.media.muted=this.player.isMuted,this.trigger("muted",this.media.muted),this.trigger("any","muted")}},{key:"controller_isPausedChanged",value:function(){this.media.paused=this.player.isPaused,this.trigger("pause",this.media.paused),this.trigger("any","pause")}},{key:"controller_playerStateChanged",value:function(){this.media.state=this.player.playerState.toLowerCase(),"idle"===this.media.state&&(this.media.state="disconnected"),this.trigger("state",this.media.state),this.trigger("any","state")}},{key:"on",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"off",value:function(e,t){if(!e)return this.events={};if(this.events[e]){if(void 0===t)return this.events[e]=[];for(var i in this.events[e])if(this.events[e][i]===t){this.events[e].splice(i,1);break}}}},{key:"trigger",value:function(e,t){for(var i in this.events[e])this.events[e][i](t)}},{key:"cast",value:(t=function(e){var a=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!e)return this.trigger("error","No media source specified.");for(var i in t.source=e,t)t.hasOwnProperty(i)&&(this.media[i]=t[i]);cast.framework.CastContext.getInstance().requestSession().then(function(){if(!cast.framework.CastContext.getInstance().getCurrentSession())return a.trigger("error","Could not connect with the cast device");var e=new chrome.cast.media.MediaInfo(a.media.source);if(e.metadata=new chrome.cast.media.GenericMediaMetadata,a.media.subtitles.length){e.textTrackStyle=new chrome.cast.media.TextTrackStyle,e.textTrackStyle.fontFamily="Arial",e.textTrackStyle.foregroundColor="#FFFFFF",e.textTrackStyle.backgroundColor="#00000000",e.textTrackStyle.fontScale="1.1",e.textTrackStyle.edgeColor="#00000099",e.textTrackStyle.edgeType="DROP_SHADOW";var t=[];for(var i in a.media.subtitles){var r=new chrome.cast.media.Track(i,"TEXT");r.trackContentId=a.media.subtitles[i].src,r.trackContentType="text/vtt",r.subtype="CAPTIONS",r.name=a.media.subtitles[i].label,t.push(r)}e.tracks=t}e.metadata.images=[{url:a.media.poster}],e.metadata.title=a.media.title,e.metadata.subtitle=a.media.description;var n=new chrome.cast.media.LoadRequest(e);if(n.currentTime=a.media.time,n.autoplay=!a.media.paused,a.media.subtitles.length)for(var i in a.media.subtitles)if(a.media.subtitles[i].active){n.activeTrackIds=[i];break}cast.framework.CastContext.getInstance().getCurrentSession().loadMedia(n).then(function(){return a.device=cast.framework.CastContext.getInstance().getCurrentSession().getCastDevice().friendlyName,a.trigger("session"),a.trigger("any","session"),a},function(e){return a.trigger("error",e),a})},function(e){return a.trigger("error",e),a})},e.toString=function(){return t.toString()},e)},{key:"seek",value:function(e){return this.player.currentTime=this.controller.getSeekTime(e,this.player.duration),this.controller.seek(),this}},{key:"volume",value:function(e){return this.player.volumeLevel=e,this.controller.setVolumeLevel(),this}},{key:"play",value:function(){return this.media.paused&&this.controller.playOrPause(),this}},{key:"pause",value:function(){return this.media.paused||this.controller.playOrPause(),this}},{key:"mute",value:function(e){return!0===e&&!1===this.media.muted?this.controller.muteOrUnmute():!1===e&&!0===this.media.muted&&this.controller.muteOrUnmute(),this}},{key:"subtitle",value:function(e){var t=new chrome.cast.media.EditTracksInfoRequest([e]);for(var i in cast.framework.CastContext.getInstance().getCurrentSession().getSessionObj().media[0].editTracksInfo(t,null,null),this.media.subtitles)delete this.media.subtitles[i].active,i===e&&(this.media.subtitles[i].active=!0);return this}},{key:"disconnect",value:function(){return cast.framework.CastContext.getInstance().endCurrentSession(!0),this.controller.stop(),this.media=Object.assign({},this.template),this.session=!1,this.media.state="disconnected",this.trigger("disconnected"),this.trigger("any","disconnected"),this}}]),n}();
